---
title: "Livecoding da(o)(e) MateBot, Rob√¥ Social (3)"
date: 2020-09-02T01:17:51-03:00
---


## Objetivos de hoje:

- [x] Acrescentar issues novas no Github
- [x] Continuar desenvolvendo o c√≥digo base do Aiogram
- [x] Documentar o processo

---

## Bibliografia (linkania):

* <https://soundcloud.com/lfzawacki/sets/stream-list>  
* <https://github.com/matehackers/matebot>  
* <https://github.com/aiogram/aiogram>  
* <https://t.me/joinchat/CwFUFkf-dKW34FPBjEJs9Q>  
* <https://docs.aiogram.dev/>  

---

## Transmiss√£o ao vivo

Come√ßou pouco ap√≥s √† meia noite BRT (UTC -3) do dia 02 de setembro de 2020 (quarta-feira j√°).  

Ao vivo no Youtube no canal do Matehackers: <https://www.youtube.com/c/Exmachinae/live>  

Salvo no Youtube:  

* <https://youtube.com/watch?v=WZVxOrKisq0>  
* <https://youtube.com/watch?v=EM_oYVM7bMo>  

**Ter√ßa Sem Fim - Livecoding da(o)(e) MateBot, Rob√¥ Social**  

> MateBot √© atualmente um(a)(e)(?) rob√¥ de Telegram que est√° sendo escrito usando Python e Aiogram com licen√ßa de software livre. Esta s√©rie de v√≠deos serve para documentar e acompanhar o processo de desenvolvimento. Al√©m do canal do Youtube do Matehackers, tamb√©m est√° sendo documentado no reposit√≥rio git p√∫blico e no blog Ter√ßa Sem Fim. Estes v√≠deos est√£o dispon√≠veis via IPFS e Tor pra quem n√£o consegue assistir pelo Youtube.

C√≥digo fonte: https://github.com/matehackers/matebot  

Blog da Ter√ßa Sem Fim:
üåê Web:
- https://denise.matehackers.org/tercasemfim/  
üßÖ Tor:
- http://ftkbuej5ggf45o5n37evqj6qhxjobrz7lyqvdz22z3me6yyuepmhgcad.onion/ (atualizado durante a transmiss√£o ao vivo)  
- http://gytdkc5fei2ow5s7hdrppbin4rlogqzqhbabvvra2qb3flccuxsnrdqd.onion/tercasemfim/ (atualizado ap√≥s a transmiss√£o ao vivo)  
üåå IPFS:
- https://ipfs.io/ipns/denise.matehackers.org/tercasemfim/  

Grupo do Matehackers no Telegram: <https://t.me/matehackerspoa>  
Grupo do MateBot no Telegram: <https://t.me/joinchat/CwFUFkf-dKW34FPBjEJs9Q>  
Meu usu√°rio no Telegram: <https://t.me/desobedientecivil>  

Ajude o Hackerspace Matehackers a se manter: <https://matehackers.org/renda>  

`#Python #Telegram #Aiogram #Geany #Flask #Quart #PythonTelegramBot #DataScience #IA #AI #ML #DS`  

---

## Desenvolvimento

### Documentando o processo

Como sempre a primeira coisa √© alimentar o blog dessa vez sem o tor porque eu estou usando o Qubes e n√£o configurei um servi√ßo oculto na VM do Whonix.  

### Github novas issues

Durante a semana foram se acumulando feedbacks e novas ideias para o bot que devem ser documentadas no [reposit√≥rio git](https://github.com/matehackers/matebot).  

√Äs 01:18 BRT terminei de colocar todas as issues do m√™s de agosto no github. Foram tr√™s no total, da 64 at√© a 66.  

Esclareci duas vezes que eu parei de usar Flask e Quart para o desenvolvimento e voltei a usar "python puro (tm)" pra desenvolver o bot como era no tempo do telepot.  

Esclareci que os pr√≥ximos passos ser√£o continuar desenvolvendo o bot usando [Aiogram](https://github.com/aiogram/aiogram) e python-telegram-bot, sendo o foco maior em Aiogram.  

Coisas para curto prazo que devem ser feitas √© refazer todo o plugin de logging (que j√° estava parcialmente desenvolvido com python-telegram-bot), fazer um controle de acesso (que j√° tinha em telepot), escrever um controle de flood (que ningu√©m escreveu, nem no telepot, nem no ptb, nem no aiogram, nem no telethon, etc.) e finalmente migrar os plugins todos no m√≠nimo para funcionar com aiogram mas preferencialmente pra funcionar com python-telegram-bot tamb√©m.  

### Geany

√Äs 01:30 BRT terminei de escrever o blog e voltei para o desenvolvimento.  

Perdi bastante tempo (de novo) tentando usar **json.dumps()** com as updates.  

Cheguei a testar o m√©todo de copiar mensagem do aiogram, mas por fim consegui fazer logging em grupos escrevendo meus pr√≥prios m√©todos e adicionando uma linha em cada handler de mensagem.  

Lancei uma vers√£o est√°vel do matebot que √© a **v0.1.3.1**. O pr√≥ximo passo √© passar todos os plugins j√° existentes para usar aiogram.  

Uma coisa engra√ßada √© que eu fiz uma cacaca no reposit√≥rio ao vivo. Ao inv√©s de fazer merge da branch _main_ na branch _async_, eu fiz o contr√°rio. Depois tive que adicionar v√°rios commits de merge para retomar o c√≥digo ao estado que estava, mas n√£o estava mais transmitindo no v√≠deo.  

---

## Encerramento

Transmiss√£o foi encerrada aproximadamente √†s 04:45 BRT de 02 de Setembro de 2020.  

> N√£o curtam o v√≠deo, n√£o sigam o canal, n√£o se inscrevam para receber notifica√ß√µes. Usem youtube-dl para obter o v√≠deo, assistam no VLC. Ou melhor, assistam o v√≠deo via IPFS.  

---

## P√≥s transmiss√£o

Consegui resolver o problema dos arquivos de configura√ß√£o. Descobri o m√©todo `Dispatcher.get_current()` que retorna o _dispatcher_ do contexto do m√©todo. Ent√£o n√£o preciso importar o **Bot()** em cada arquivo do c√≥digo. [Commit com esta corre√ß√£o](https://github.com/matehackers/matebot/commit/e094cdd66bd1e82840cab8211ae4afcc89afc02b). Na [documenta√ß√£o do aiogram](https://docs.aiogram.dev) n√£o tinha essa informa√ß√£o, eu abri [uma issue no reposit√≥rio](https://github.com/aiogram/aiogram/issues/412) para isto.  

Consegui resolver o problema do pretty print para as updates. O objeto [TelegramObject](https://docs.aiogram.dev/en/latest/telegram/types/base.html#telegramobject) que √© base para os outros objetos tem os m√©todos **[to_python()](https://docs.aiogram.dev/en/latest/telegram/types/base.html#aiogram.types.base.TelegramObject.to_python)** e **[as_json()](https://docs.aiogram.dev/en/latest/telegram/types/base.html#aiogram.types.base.TelegramObject.as_json)** que eu consegui usar pra formatar os updates nos logs. [Commit com esta altera√ß√£o](https://github.com/matehackers/matebot/commit/146865583f863adde28d235532a69faf204154c5).  

